var valid_patterns = {
	phone:/^\(\d{3}\) \d{3}-\d{4}$/,
	zipcode:'^[0-9]{5}$',
	socialsecurity:'^(?!219099999|078051120)(?!000|9[0-9]{2})[0-9]{3}-(?!00)[0-9]{2}-(?!0{4})[0-9]{4}$',
	date:/^[0-9]{2}[\/]{1}[0-9]{2}[\/]{1}[0-9]{4}$/,
	dollar:/^\$?\d+(,\d{3})*(\.[0-9]{2})?$/,
	dollarbad:/^\$?[0-9]+(\.[0-9][0-9])?$/,
	};

function Validate(obj)	{
	
	var form = $(obj).closest('form');
	if (typeof(form) != 'undefined')
	{
		//console.log('count = '+ $(form).find('.validate').length);
		var pass_validation = true;
		$(form).find('.validate').each( function( index ) {
			if ($(this).is(':visible') && ValidateInput(this) != 1)
		  		pass_validation = false;
		});
		
		if (pass_validation)
			$('#submit').removeClass('disabled');
		else
			$('#submit').addClass('disabled');
	}
	else
	{
		console.log('unable to find form...');
	}
}
	
function ValidateInput(obj) {
	
	var result = 0;
	var validate = $(obj).data('validate');
	switch(validate)
	{
		case 'email':
			var val = $(obj).val();
			if (val.length > 0)
            {
				if (ValidateEmail(val))
					result = 1;
				else
					result = -1;
			}
            else if (!$(obj).hasClass('optional'))
            {
				result = -1;
            }
			break;
		
		default:
			if (typeof(validate) !== 'undefined' && typeof(valid_patterns[validate]) !== 'undefined')
			{
				var val = $(obj).val();
                var patt = new RegExp(valid_patterns[validate]);
                if (patt.test(val))
                    result = 1;
                else if ($(obj).hasClass('optional') && val.length == 0)
                    result = 0;
                else
                    result = -1;
			}
			else
			{
				if ($(obj).val().trim().length > 0)
					result = 1;
				else if (!$(obj).hasClass('optional'))
					result = -1;
                else
                    result = 0;
			}
			break;
	}
	
	// check/show validation icon
	var validation = $(obj).closest('.validation');
	if (typeof(validation) != 'undefined')
	{
		if (result > 0)
		{
			$(validation).removeClass('invalid');
			$(validation).addClass('valid');
		}
		else if (result < 0)
		{
			$(validation).removeClass('valid');
			$(validation).addClass('invalid');
		}
		else
		{
			$(validation).removeClass('invalid');
			$(validation).removeClass('valid');
		}
	}
	
	// check if optional and not invalid and "pass" it
	if ($(obj).hasClass('optional') && result == 0)
		return 1;
	
	return result;
}

function ValidateEmail(email) {
    var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
    return re.test(email);
}
