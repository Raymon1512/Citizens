
function FilterInit(parent) {
  var formatted = $(parent).find('input.filter').each(function (index, element) {
    var filter = $(element).data('filter');
    
    switch (filter) {
      case 'phone':
          //var cleave = new Cleave('#' + element.id, {
          var cleave = new Cleave(element, {
            blocks: [0, 3, 3, 4],
            delimiters: ['(', ') ','-'],
            numericOnly: true,
          });
          break;

      case 'socialsecurity':
          var cleave = new Cleave(element, {
            blocks: [3, 2, 4],
            delimiter: '-',
            numericOnly: true,
          });
          break;
        
      case 'creditcard':
          var cleave = new Cleave(element, {
            blocks: [4, 4, 4, 4],
            delimiter: ' ',
            numericOnly: true,
          });
          break;
        
      case 'creditcard-exp':
          var cleave = new Cleave(element, {
            date: true,
            datePattern: ['m', 'Y'],
          });
          break;

      case 'zipcode':
          var cleave = new Cleave(element, {
            blocks: [5],
            numericOnly: true,
          });
          break;
        
      case 'zipcodelong':
          var cleave = new Cleave(element, {
            blocks: [5,4],
            delimiter: '-',
            delimiterLazyShow: true,
            numericOnly: true,
          });
          break;

      case 'dollar':
          $(element).on('focus', function() { AmountFilter(element); });
          $(element).on('input', function() { AmountFilter(element); });
          $(element).on('blur', function() { AmountBlur(element); });
          break;

      case 'date':
          var cleave = new Cleave(element, {
            date: true,
            datePattern: ['m', 'd', 'Y'],
          });
          break;

      case 'number':
          var cleave = new Cleave(element, {
            blocks: [5],
            numericOnly: true,
          });
          break;
        
      case 'numeric':
          var maxlen = $(element).attr('maxlength');
          if (maxlen != undefined)
          {
            var cleave = new Cleave(element, {
              blocks: [maxlen],
              numericOnly: true,
            });
          }
          break;
    }
  });
}


function AmountFilter(obj) {
	var p = 0;
	var val = $(obj).val();
	var filtered = '';
	for (i=0; i<val.length; i++)
	{
		var char = val[i];
		if (char == '.')
		{
			if (p == 0)
			{
				filtered += char;
				p = 1;
			}
		}
		if (char >= '0' && char <= '9')
		{
			if (p < 3)
			{
				filtered += char;
				if (p > 0)
					p++;
			}
		}
	}
		
	$(obj).val(filtered);
	
	// optionally validate
	//if ($(obj).hasClass('validate'))
	//	Validate(obj);
}

function AmountBlur(obj) {
	var val = $(obj).val();
	if (val.length > 0)
	{
		var amount = parseFloat(val);
		var filtered = amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
		$(obj).val(filtered);
	}
}
